<div class="p-6 max-w-5xl mx-auto">
  <h2 class="text-2xl font-bold mb-6 text-blue-600">Manage Items</h2>

  <!-- üîô Back Button -->
  <button
    (click)="goBack()"
    class="mb-4 inline-flex items-center text-blue-600 hover:text-blue-800 font-medium"
  >
    ‚Üê Back
  </button>

  <!-- Add Item Form -->
  <form
    (ngSubmit)="addItem()"
    class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8"
    enctype="multipart/form-data"
  >
    <input
      type="text"
      [(ngModel)]="itemName"
      name="name"
      placeholder="Item Name"
      class="border p-2 rounded"
      required
    />

    <select
      [(ngModel)]="itemCategory"
      name="categoryId"
      class="border p-2 rounded"
      required
    >
      <option disabled value="">Select Category</option>
      <option *ngFor="let cat of categories" [value]="cat._id">{{ cat.name }}</option>
    </select>

    <!-- Quantity Field with Label -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Quantity</label>
      <input
        type="number"
        [(ngModel)]="itemQuantity"
        name="quantity"
        placeholder="Enter quantity"
        class="border p-2 rounded w-full"
        required
      />
    </div>

    <!-- Price Field with Label -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Price (‚Ç±)</label>
      <input
        type="number"
        [(ngModel)]="itemPrice"
        name="price"
        placeholder="Enter price"
        class="border p-2 rounded w-full"
        required
      />
    </div>

    <!-- Custom File Upload + Preview -->
    <div class="col-span-2 flex flex-col md:flex-row md:items-center gap-4">
      <label
        class="cursor-pointer inline-block bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded shadow-md"
      >
        Choose Image
        <input
          type="file"
          accept="image/*"
          (change)="onFileSelected($event)"
          class="hidden"
        />
      </label>

      <div *ngIf="imagePreview" class="mt-2 md:mt-0">
        <p class="text-sm text-gray-600 mb-1">Image Preview:</p>
        <img [src]="imagePreview" class="w-32 h-32 object-cover rounded border" />
      </div>
    </div>

    <button
      type="submit"
      class="col-span-2 bg-blue-600 text-white p-2 rounded hover:bg-blue-700"
    >
      Add Item
    </button>
  </form>

  <!-- Item List Table -->
  <table class="w-full bg-white shadow rounded overflow-x-auto">
    <thead class="bg-blue-100 text-blue-800">
      <tr>
        <th class="text-left p-3">Image</th>
        <th class="text-left p-3">Name</th>
        <th class="text-left p-3">Category</th>
        <th class="text-left p-3">Quantity</th>
        <th class="text-left p-3">Price</th>
        <th class="text-right p-3">Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of items" class="border-b">
        <td class="p-3">
          <img
            *ngIf="item.image"
            [src]="'http://localhost:5000' + item.image"
            alt="item"
            class="w-16 h-16 object-cover rounded"
          />
        </td>
        <td class="p-3">{{ item.name }}</td>
        <td class="p-3">{{ item.categoryId?.name }}</td>
        <td class="p-3">{{ item.quantity }}</td>
        <td class="p-3">{{ item.price | currency:'PHP':'symbol':'1.2-2' }}</td>
        <td class="p-3 text-right space-x-2">
          <button (click)="startEdit(item)" class="text-blue-600 hover:underline">Edit</button>
          <button (click)="deleteItem(item._id)" class="text-red-600 hover:underline">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Edit Modal -->
<div
  *ngIf="editingItem"
  class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 px-4"
>
  <div class="bg-white w-full max-w-lg p-6 rounded shadow-lg relative">
    <h2 class="text-xl font-bold text-blue-700 mb-4">Edit Item</h2>

    <form (ngSubmit)="saveEdit()" enctype="multipart/form-data" class="grid gap-4">
      <input
        type="text"
        [(ngModel)]="editName"
        name="editName"
        placeholder="Item Name"
        class="border p-2 rounded"
        required
      />
      <select
        [(ngModel)]="editCategory"
        name="editCategory"
        class="border p-2 rounded"
        required
      >
        <option *ngFor="let cat of categories" [value]="cat._id">{{ cat.name }}</option>
      </select>

      <!-- Quantity Field with Label -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Quantity</label>
        <input
          type="number"
          [(ngModel)]="editQuantity"
          name="editQuantity"
          class="border p-2 rounded w-full"
          placeholder="Quantity"
          required
        />
      </div>

      <!-- Price Field with Label -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Price (‚Ç±)</label>
        <input
          type="number"
          [(ngModel)]="editPrice"
          name="editPrice"
          class="border p-2 rounded w-full"
          placeholder="Price"
          required
        />
      </div>
 
      <!-- Edit Image Upload + Preview -->
      <div class="flex flex-col md:flex-row md:items-center gap-4">
        <label
          class="cursor-pointer inline-block bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded shadow-md"
        >
          Change Image
          <input
            type="file"
            accept="image/*"
            (change)="onEditFileSelected($event)"
            class="hidden"
          />
        </label>

        <div *ngIf="editImagePreview" class="mt-2 md:mt-0">
          <p class="text-sm text-gray-600 mb-1">Current/Selected Image:</p>
          <img [src]="editImagePreview" class="w-32 h-32 object-cover rounded border" />
        </div>
      </div>

      <div class="flex justify-end gap-2">
        <button type="button" (click)="cancelEdit()" class="px-4 py-2 bg-gray-200 rounded">
          Cancel
        </button>
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
          Save Changes
        </button>
      </div>
    </form>
  </div>
</div>
